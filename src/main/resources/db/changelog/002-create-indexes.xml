
<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog>

    <!-- Patient Indexes -->
    <changeSet id="001-create-patient-indexes" author="mediroute">
        <createIndex tableName="patients" indexName="idx_patients_org">
            <column name="org_id"/>
        </createIndex>
        <createIndex tableName="patients" indexName="idx_patients_phone">
            <column name="phone"/>
        </createIndex>

        <createIndex tableName="patients" indexName="idx_patients_name">
            <column name="name"/>
        </createIndex>

        <createIndex tableName="patients" indexName="idx_patients_active">
            <column name="is_active"/>
        </createIndex>
    </changeSet>

    <!-- Driver Indexes -->
    <changeSet id="002-create-driver-indexes" author="mediroute">
        <createIndex tableName="drivers" indexName="idx_drivers_org">
            <column name="org_id"/>
        </createIndex>
        <createIndex tableName="drivers" indexName="idx_drivers_active">
            <column name="active"/>
        </createIndex>

        <createIndex tableName="drivers" indexName="idx_drivers_vehicle_type">
            <column name="vehicle_type"/>
        </createIndex>

        <createIndex tableName="drivers" indexName="idx_drivers_capabilities">
            <column name="wheelchair_accessible"/>
            <column name="stretcher_capable"/>
            <column name="oxygen_equipped"/>
        </createIndex>

        <createIndex tableName="drivers" indexName="idx_drivers_location">
            <column name="base_lat"/>
            <column name="base_lng"/>
        </createIndex>
    </changeSet>

    <!-- Ride Indexes -->
    <changeSet id="003-create-ride-indexes" author="mediroute">
        <createIndex tableName="rides" indexName="idx_rides_org">
            <column name="org_id"/>
        </createIndex>
        <createIndex tableName="rides" indexName="idx_rides_pickup_time">
            <column name="pickup_time"/>
        </createIndex>

        <createIndex tableName="rides" indexName="idx_rides_status">
            <column name="status"/>
        </createIndex>

        <createIndex tableName="rides" indexName="idx_rides_priority">
            <column name="priority"/>
        </createIndex>

        <createIndex tableName="rides" indexName="idx_rides_batch">
            <column name="optimization_batch_id"/>
        </createIndex>

        <createIndex tableName="rides" indexName="idx_rides_patient_time">
            <column name="patient_id"/>
            <column name="pickup_time"/>
        </createIndex>

        <createIndex tableName="rides" indexName="idx_rides_driver_time">
            <column name="pickup_driver_id"/>
            <column name="pickup_time"/>
        </createIndex>

        <!-- Frequently queried unassigned rides by date -->
        <createIndex tableName="rides" indexName="idx_rides_date_status">
            <column name="pickup_time"/>
            <column name="status"/>
        </createIndex>
    </changeSet>

    <!-- Assignment Audit org index -->
    <changeSet id="004-assignment-audit-org-index" author="mediroute">
        <createIndex tableName="assignment_audit" indexName="idx_assignment_audit_org">
            <column name="org_id"/>
        </createIndex>
    </changeSet>

    <!-- Auth indexes -->
    <changeSet id="004-auth-indexes" author="mediroute">
        <createIndex tableName="app_users" indexName="idx_app_users_active">
            <column name="active"/>
        </createIndex>
        <createIndex tableName="refresh_tokens" indexName="idx_refresh_tokens_revoked">
            <column name="revoked"/>
        </createIndex>
    </changeSet>

</databaseChangeLog>